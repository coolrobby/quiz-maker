<!-- Footerå†…å®¹ -->
    <footer class="footer">
        <div class="container">
            <p>ç½‘ç«™ç”±<a href="https://hydun.com/" target="_blank">ç«æ¯…ç›¾äº‘å®‰å…¨</a>æä¾›é˜²æŠ¤åŠCDNåŠ é€ŸæœåŠ¡</p>
        </div>
    </footer>
    
    <script>
// ä¸»è¦JavaScriptåŠŸèƒ½

// å¼¹çª—åŠŸèƒ½
function showConsultModal() {
    const modal = document.getElementById('consultModal');
    if (modal) {
        modal.style.display = 'block';
    }
}

function hideConsultModal() {
    const modal = document.getElementById('consultModal');
    if (modal) {
        modal.style.display = 'none';
    }
}

// ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­å¼¹çª—
window.onclick = function(event) {
    const modal = document.getElementById('consultModal');
    if (event.target === modal) {
        hideConsultModal();
    }
}

// åˆå§‹åŒ–å¯¼èˆªåŠŸèƒ½
function initNavigation() {
    // åˆå§‹åŒ–å’¨è¯¢æŒ‰é’®
    const consultBtn = document.getElementById('consultBtn');
    if (consultBtn) {
        consultBtn.addEventListener('click', function(e) {
            e.preventDefault();
            showConsultModal();
        });
    }
    
    // åˆå§‹åŒ–ç§»åŠ¨ç«¯èœå•
    initMobileMenu();
    
    console.log('Navigation initialized');
}

// ç§»åŠ¨ç«¯èœå•åŠŸèƒ½
function initMobileMenu() {
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
    const closeMobileMenu = document.getElementById('closeMobileMenu');
    const mobileConsultBtn = document.getElementById('mobileConsultBtn');
    
    if (mobileMenuToggle && mobileMenuOverlay) {
        // æ‰“å¼€èœå•
        mobileMenuToggle.addEventListener('click', function() {
            mobileMenuToggle.classList.add('active');
            mobileMenuOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        });
        
        // å…³é—­èœå•
        function closeMobileMenuFunc() {
            mobileMenuToggle.classList.remove('active');
            mobileMenuOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        // ç‚¹å‡»å…³é—­æŒ‰é’®
        if (closeMobileMenu) {
            closeMobileMenu.addEventListener('click', closeMobileMenuFunc);
        }
        
        // ç‚¹å‡»é®ç½©å±‚å…³é—­
        mobileMenuOverlay.addEventListener('click', function(e) {
            if (e.target === mobileMenuOverlay) {
                closeMobileMenuFunc();
            }
        });
        
        // ç§»åŠ¨ç«¯å’¨è¯¢æŒ‰é’®
        if (mobileConsultBtn) {
            mobileConsultBtn.addEventListener('click', function(e) {
                e.preventDefault();
                closeMobileMenuFunc();
                setTimeout(() => {
                    showConsultModal();
                }, 300);
            });
        }
        
        // ç‚¹å‡»èœå•é¡¹åå…³é—­èœå•ï¼ˆé™¤äº†å’¨è¯¢æŒ‰é’®ï¼‰
        const menuItems = document.querySelectorAll('.mobile-menu-item:not(#mobileConsultBtn)');
        menuItems.forEach(item => {
            item.addEventListener('click', function() {
                closeMobileMenuFunc();
            });
        });
    }
}

// ç­”é¢˜ç›¸å…³JavaScriptåŠŸèƒ½
class QuizApp {
    constructor() {
        this.questions = [];
        this.currentQuestionIndex = 0;
        this.userAnswers = [];
        this.startTime = null;
        this.endTime = null;
        this.shuffleQuestions = false;
        this.shuffleOptions = false;
        this.quizStarted = false;
        this.originalQuestions = [];
    }

    init(questionsData) {
        this.originalQuestions = JSON.parse(JSON.stringify(questionsData));
        this.questions = JSON.parse(JSON.stringify(questionsData));
        this.userAnswers = new Array(this.questions.length).fill(null);
        this.setupEventListeners();
        this.renderQuestions();
    }

    setupEventListeners() {
        const startBtn = document.getElementById('startQuiz');
        if (startBtn) {
            startBtn.addEventListener('click', () => this.startQuiz());
        }

        const shuffleQuestionsToggle = document.getElementById('shuffleQuestions');
        if (shuffleQuestionsToggle) {
            shuffleQuestionsToggle.addEventListener('change', (e) => {
                this.shuffleQuestions = e.target.checked;
            });
        }

        const shuffleOptionsToggle = document.getElementById('shuffleOptions');
        if (shuffleOptionsToggle) {
            shuffleOptionsToggle.addEventListener('change', (e) => {
                this.shuffleOptions = e.target.checked;
            });
        }
    }

    shuffleArray(array) {
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }

    startQuiz() {
        this.quizStarted = true;
        this.startTime = new Date();
        
        // é‡ç½®é¢˜ç›®å’Œç­”æ¡ˆ
        this.questions = JSON.parse(JSON.stringify(this.originalQuestions));
        this.userAnswers = new Array(this.questions.length).fill(null);
        
        // æ‰“ä¹±é¢˜ç›®é¡ºåº
        if (this.shuffleQuestions) {
            this.questions = this.shuffleArray(this.questions);
        }
        
        // æ‰“ä¹±é€‰é¡¹é¡ºåº
        if (this.shuffleOptions) {
            this.questions.forEach(question => {
                if (question.type === 'choice' && question.options) {
                    const correctAnswer = question.answer;
                    const optionsWithLabels = question.options.map((option, index) => ({
                        text: option,
                        originalLabel: String.fromCharCode(65 + index)
                    })).filter(option => option.text.trim() !== '');
                    
                    const shuffledOptions = this.shuffleArray(optionsWithLabels);
                    question.options = shuffledOptions.map(option => option.text);
                    
                    // æ›´æ–°æ­£ç¡®ç­”æ¡ˆä¸ºå®é™…å†…å®¹è€Œä¸æ˜¯å­—æ¯
                    const correctIndex = this.originalQuestions.find(q => 
                        q.question === question.question
                    ).options.findIndex(opt => opt === correctAnswer);
                    
                    if (correctIndex !== -1) {
                        question.answer = this.originalQuestions.find(q => 
                            q.question === question.question
                        ).options[correctIndex];
                    }
                }
            });
        }
        
        this.renderQuestions();
        
        // éšè—æ§åˆ¶é¢æ¿ï¼Œæ˜¾ç¤ºé¢˜ç›®
        const controlsDiv = document.querySelector('.quiz-controls');
        if (controlsDiv) {
            controlsDiv.style.display = 'none';
        }
        
        // æ»šåŠ¨åˆ°ç¬¬ä¸€é¢˜
        const firstQuestion = document.querySelector('.question-container');
        if (firstQuestion) {
            firstQuestion.scrollIntoView({ behavior: 'smooth' });
        }
    }

    renderQuestions() {
        const container = document.getElementById('questionsContainer');
        if (!container) return;
        
        container.innerHTML = '';
        
        this.questions.forEach((question, index) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-container';
            questionDiv.id = `question-${index}`;
            
            let optionsHtml = '';
            
            if (question.type === 'choice') {
                const validOptions = question.options.filter(opt => opt && opt.trim() !== '');
                optionsHtml = validOptions.map((option, optIndex) => `
                    <div class="option" data-question="${index}" data-value="${option}">
                        <span class="option-label">${String.fromCharCode(65 + optIndex)}.</span>
                        <span class="option-text">${option}</span>
                    </div>
                `).join('');
            } else if (question.type === 'fill') {
                optionsHtml = `
                    <input type="text" class="fill-blank-input" data-question="${index}" 
                           placeholder="è¯·è¾“å…¥ç­”æ¡ˆ..." autocomplete="off">
                `;
            }
            
            questionDiv.innerHTML = `
                <div class="question-header">
                    <span class="question-number">ç¬¬ ${index + 1} é¢˜</span>
                    <span class="question-status" id="status-${index}"></span>
                </div>
                <div class="question-text">${question.question}</div>
                <div class="options-container">
                    ${optionsHtml}
                </div>
                <div class="question-actions">
                    <button class="submit-btn" onclick="quizApp.submitAnswer(${index})" 
                            id="submit-${index}" disabled>æäº¤ç­”æ¡ˆ</button>
                    <button class="finish-btn" onclick="quizApp.finishQuiz()">äº¤å·</button>
                </div>
                <div class="answer-feedback" id="feedback-${index}" style="display: none;"></div>
            `;
            
            container.appendChild(questionDiv);
        });
        
        this.setupQuestionEventListeners();
    }

    setupQuestionEventListeners() {
        // é€‰æ‹©é¢˜ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.option').forEach(option => {
            option.addEventListener('click', (e) => {
                const questionIndex = parseInt(e.currentTarget.dataset.question);
                const value = e.currentTarget.dataset.value;
                
                // ç§»é™¤åŒä¸€é¢˜ç›®çš„å…¶ä»–é€‰ä¸­çŠ¶æ€
                document.querySelectorAll(`[data-question="${questionIndex}"]`).forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // æ·»åŠ é€‰ä¸­çŠ¶æ€
                e.currentTarget.classList.add('selected');
                
                // å¯ç”¨æäº¤æŒ‰é’®
                const submitBtn = document.getElementById(`submit-${questionIndex}`);
                if (submitBtn) {
                    submitBtn.disabled = false;
                }
                
                // ä¿å­˜ç­”æ¡ˆ
                this.userAnswers[questionIndex] = value;
            });
        });
        
        // å¡«ç©ºé¢˜è¾“å…¥äº‹ä»¶
        document.querySelectorAll('.fill-blank-input').forEach(input => {
            input.addEventListener('input', (e) => {
                const questionIndex = parseInt(e.target.dataset.question);
                const value = e.target.value.trim();
                
                // å¯ç”¨/ç¦ç”¨æäº¤æŒ‰é’®
                const submitBtn = document.getElementById(`submit-${questionIndex}`);
                if (submitBtn) {
                    submitBtn.disabled = value === '';
                }
                
                // ä¿å­˜ç­”æ¡ˆ
                this.userAnswers[questionIndex] = value;
            });
            
            // å›è½¦æäº¤
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const questionIndex = parseInt(e.target.dataset.question);
                    this.submitAnswer(questionIndex);
                }
            });
        });
    }

    submitAnswer(questionIndex) {
        const question = this.questions[questionIndex];
        const userAnswer = this.userAnswers[questionIndex];
        
        if (!userAnswer) return;
        
        const isCorrect = this.checkAnswer(question, userAnswer);
        
        // æ˜¾ç¤ºåé¦ˆ
        this.showFeedback(questionIndex, isCorrect, question.answer);
        
        // ç¦ç”¨è¯¥é¢˜ç›®çš„äº¤äº’
        this.disableQuestion(questionIndex);
        
        // æ»šåŠ¨åˆ°ä¸‹ä¸€é¢˜
        this.scrollToNextQuestion(questionIndex);
        
        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é¢˜ç›®éƒ½å·²å®Œæˆï¼Œå¦‚æœæ˜¯åˆ™è‡ªåŠ¨äº¤å·
        this.checkAutoSubmit();
    }

    checkAnswer(question, userAnswer) {
        if (question.type === 'fill') {
            return userAnswer.toLowerCase().trim() === question.answer.toLowerCase().trim();
        } else {
            return userAnswer === question.answer;
        }
    }

    showFeedback(questionIndex, isCorrect, correctAnswer) {
        const statusElement = document.getElementById(`status-${questionIndex}`);
        const feedbackElement = document.getElementById(`feedback-${questionIndex}`);
        
        if (statusElement) {
            statusElement.textContent = isCorrect ? 'âœ“' : 'âœ—';
            statusElement.className = `question-status ${isCorrect ? 'correct' : 'incorrect'}`;
        }
        
        if (feedbackElement) {
            feedbackElement.style.display = 'block';
            feedbackElement.className = `answer-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            const feedbackMessage = isCorrect 
                ? 'âœ“ å›ç­”æ­£ç¡®ï¼' 
                : `âœ— å›ç­”é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${correctAnswer}`;
            
            feedbackElement.innerHTML = `
                ${feedbackMessage}
                <div class="feedback-info">
                    <div>ğŸŒ www.tkykt.com</div>
                    <div>ğŸ“± å¾®ä¿¡è®¢é˜…å·ï¼šå¦å…‹äº‘è¯¾å ‚</div>
                </div>
            `;
        }
        
        // æ ‡è®°é€‰é¡¹é¢œè‰²
        if (this.questions[questionIndex].type === 'choice') {
            const options = document.querySelectorAll(`[data-question="${questionIndex}"]`);
            options.forEach(option => {
                const optionValue = option.dataset.value;
                if (optionValue === correctAnswer) {
                    option.classList.add('correct');
                } else if (optionValue === this.userAnswers[questionIndex] && !isCorrect) {
                    option.classList.add('incorrect');
                }
            });
        } else {
            const input = document.querySelector(`input[data-question="${questionIndex}"]`);
            if (input) {
                input.classList.add(isCorrect ? 'correct' : 'incorrect');
            }
        }
    }

    disableQuestion(questionIndex) {
        // ç¦ç”¨é€‰é¡¹ç‚¹å‡»
        const options = document.querySelectorAll(`[data-question="${questionIndex}"]`);
        options.forEach(option => {
            option.style.pointerEvents = 'none';
        });
        
        // ç¦ç”¨è¾“å…¥æ¡†
        const input = document.querySelector(`input[data-question="${questionIndex}"]`);
        if (input) {
            input.disabled = true;
        }
        
        // ç¦ç”¨æäº¤æŒ‰é’®
        const submitBtn = document.getElementById(`submit-${questionIndex}`);
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.textContent = 'å·²æäº¤';
        }
    }

    scrollToNextQuestion(currentIndex) {
        const nextIndex = currentIndex + 1;
        if (nextIndex < this.questions.length) {
            setTimeout(() => {
                const nextQuestion = document.getElementById(`question-${nextIndex}`);
                if (nextQuestion) {
                    nextQuestion.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 1000);
        }
    }

    checkAutoSubmit() {
        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é¢˜ç›®éƒ½å·²å›ç­”
        const allAnswered = this.userAnswers.every((answer, index) => {
            return answer !== null && answer !== undefined && answer !== '';
        });
        
        if (allAnswered && this.userAnswers.length === this.questions.length) {
            // 2ç§’åè‡ªåŠ¨äº¤å·
            setTimeout(() => {
                this.finishQuiz();
            }, 2000);
        }
    }

    finishQuiz() {
        this.endTime = new Date();
        this.showResults();
    }

    showResults() {
        const container = document.getElementById('questionsContainer');
        if (!container) return;
        
        const totalQuestions = this.questions.length;
        const answeredQuestions = this.userAnswers.filter(answer => answer !== null).length;
        const correctAnswers = this.questions.filter((question, index) => {
            const userAnswer = this.userAnswers[index];
            return userAnswer !== null && this.checkAnswer(question, userAnswer);
        }).length;
        
        const incorrectAnswers = answeredQuestions - correctAnswers;
        const accuracy = answeredQuestions > 0 ? (correctAnswers / answeredQuestions * 100).toFixed(1) : 0;
        const duration = this.endTime && this.startTime ? 
            Math.round((this.endTime - this.startTime) / 1000) : 0;
        
        // ç»Ÿè®¡å„é¢˜å‹æ­£ç¡®ç‡
        const choiceQuestions = this.questions.filter(q => q.type === 'choice');
        const fillQuestions = this.questions.filter(q => q.type === 'fill');
        
        const choiceCorrect = choiceQuestions.filter((question, originalIndex) => {
            const index = this.questions.indexOf(question);
            const userAnswer = this.userAnswers[index];
            return userAnswer !== null && this.checkAnswer(question, userAnswer);
        }).length;
        
        const fillCorrect = fillQuestions.filter((question, originalIndex) => {
            const index = this.questions.indexOf(question);
            const userAnswer = this.userAnswers[index];
            return userAnswer !== null && this.checkAnswer(question, userAnswer);
        }).length;
        
        const choiceAccuracy = choiceQuestions.length > 0 ? 
            (choiceCorrect / choiceQuestions.length * 100).toFixed(1) : 'N/A';
        const fillAccuracy = fillQuestions.length > 0 ? 
            (fillCorrect / fillQuestions.length * 100).toFixed(1) : 'N/A';
        
        // ç”Ÿæˆé¢˜ç›®æ€»ç»“ï¼ˆæ˜¾ç¤ºæ‰€æœ‰é¢˜ç›®ï¼‰
        const reviewItems = this.questions.map((question, index) => {
            const userAnswer = this.userAnswers[index];
            const isCorrect = userAnswer !== null && this.checkAnswer(question, userAnswer);
            
            return {
                question: question.question,
                userAnswer: userAnswer || 'æœªä½œç­”',
                correctAnswer: question.answer,
                isCorrect: isCorrect,
                type: question.type
            };
        }); // ä¸å†è¿‡æ»¤ï¼Œæ˜¾ç¤ºæ‰€æœ‰é¢˜ç›®
        
        const reviewHtml = reviewItems.map(item => `
            <div class="review-item ${item.isCorrect ? 'correct' : 'incorrect'}">
                <div class="review-question">${item.question}</div>
                <div class="review-answer user">ä½ çš„ç­”æ¡ˆï¼š${item.userAnswer}</div>
                <div class="review-answer correct">æ­£ç¡®ç­”æ¡ˆï¼š${item.correctAnswer}</div>
                <div class="review-status ${item.isCorrect ? 'correct' : 'incorrect'}">
                    ${item.isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯'}
                </div>
            </div>
        `).join('');
        
        container.innerHTML = `
            <div class="results-container">
                <h2 class="results-title">ç­”é¢˜å®Œæˆï¼</h2>
                <div class="score-display">${accuracy}%</div>
                
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-value">${totalQuestions}</span>
                        <div class="stat-label">æ€»é¢˜æ•°</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${correctAnswers}</span>
                        <div class="stat-label">æ­£ç¡®é¢˜æ•°</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${incorrectAnswers}</span>
                        <div class="stat-label">é”™è¯¯é¢˜æ•°</div>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${duration}s</span>
                        <div class="stat-label">ç­”é¢˜æ—¶é—´</div>
                    </div>
                    ${choiceQuestions.length > 0 ? `
                    <div class="stat-item">
                        <span class="stat-value">${choiceAccuracy}%</span>
                        <div class="stat-label">é€‰æ‹©é¢˜æ­£ç¡®ç‡</div>
                    </div>
                    ` : ''}
                    ${fillQuestions.length > 0 ? `
                    <div class="stat-item">
                        <span class="stat-value">${fillAccuracy}%</span>
                        <div class="stat-label">å¡«ç©ºé¢˜æ­£ç¡®ç‡</div>
                    </div>
                    ` : ''}
                </div>
                
                <div class="review-section">
                    <h3 class="review-title">é¢˜ç›®æ€»ç»“</h3>
                    ${reviewHtml}
                </div>
                
                <button class="restart-btn" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
            </div>
        `;
        
        // æ»šåŠ¨åˆ°ç»“æœé¡µé¢
        container.scrollIntoView({ behavior: 'smooth' });
    }
}

// å…¨å±€å˜é‡
let quizApp;

// é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // åˆå§‹åŒ–å¯¼èˆªåŠŸèƒ½
    initNavigation();
    
    // å¹³æ»‘æ»šåŠ¨
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    });
    
    // åˆå§‹åŒ–ç­”é¢˜åº”ç”¨ï¼ˆå¦‚æœé¡µé¢åŒ…å«é¢˜ç›®æ•°æ®ï¼‰
    if (typeof questionsData !== 'undefined') {
        quizApp = new QuizApp();
        quizApp.init(questionsData);
    }
});
    </script>
</body>
</html>